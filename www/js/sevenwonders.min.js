!function(){var e=function(e,t){var n=e();e(t()),t(n)},t=function(){var t=function(e,t){var n={id:e,name:t,active:ko.observable(!1)};return n},n=t("leaders","Leaders"),a=t("cities","Cities"),o=t("towerOfBabel","Tower of Babel"),r=t("greatProjects","Great Projects"),c=[n,a,o,r],l=function(e,t,n){n=n||{};var a=n.available||ko.computed(function(){return!0}),o=n.activeByDefault||!1,r=ko.observable(o),i=ko.computed({read:function(){return a()?r():!1},write:function(e){r(e)}}),c={id:e,name:t,active:i,available:a};return c},u=l("teams","Teams",{available:ko.computed(function(){return a.active()}),activeByDefault:!1}),s=[u],m=ko.computed(function(){return $.grep(s,function(e){return e.available()})}),d=ko.computed(function(){return m().length>0}),p=function(e,t){var n=parseInt(e,10);return isNaN(n)&&(n=t),n},f=function(e){return p(e,0)},b=function(e,t){var n=p(e,null),a=ko.unwrap(t.min),o=ko.unwrap(t.max);return a>n?n=a:n>o&&(n=o),n},v=function(t){var n={scoreEditable:ko.observable(null)};return n.score=ko.computed(function(){var e=n.scoreEditable();return b(e,{min:t.min,max:t.max})}).extend({throttle:400}),n.swapWith=function(t){e(n.scoreEditable,t.scoreEditable)},n.clear=function(){n.scoreEditable(null)},n.toJS=function(){return n.score()},n.fromJS=function(e){e&&n.scoreEditable(e)},n},g=function(t){var a={tabletEditable:ko.observable(null),gearEditable:ko.observable(null),compassEditable:ko.observable(null),wildEditable:ko.observable(null),isAristotleActive:ko.computed(function(){return n.active()}),hasAristotle:ko.observable(!1)};return a.tablet=ko.computed(function(){return b(a.tabletEditable(),{min:t.min,max:t.max})}).extend({throttle:400}),a.gear=ko.computed(function(){return b(a.gearEditable(),{min:t.min,max:t.max})}).extend({throttle:400}),a.compass=ko.computed(function(){return b(a.compassEditable(),{min:t.min,max:t.max})}).extend({throttle:400}),a.wild=ko.computed(function(){return b(a.wildEditable(),{min:t.min,max:t.max})}).extend({throttle:400}),a.setMultiplier=ko.computed(function(){return a.isAristotleActive()&&a.hasAristotle()?10:7}),a.score=ko.computed(function(){return sciencesolver.calculateScoreWithWilds(f(a.tablet()),f(a.gear()),f(a.compass()),f(a.wild()),a.setMultiplier())}),a.swapWith=function(t){e(a.tabletEditable,t.tabletEditable),e(a.gearEditable,t.gearEditable),e(a.compassEditable,t.compassEditable),e(a.wildEditable,t.wildEditable),e(a.hasAristotle,t.hasAristotle)},a.clear=function(){a.tabletEditable(null),a.gearEditable(null),a.compassEditable(null),a.wildEditable(null),a.hasAristotle(!1)},a.toJS=function(){var e={};return e.tablet=a.tabletEditable(),e.gear=a.gearEditable(),e.compass=a.compassEditable(),e.wild=a.wildEditable(),e.hasAristotle=a.hasAristotle()===!0,e},a.fromJS=function(e){e&&(a.tabletEditable(e.tablet),a.gearEditable(e.gear),a.compassEditable(e.compass),a.wildEditable(e.wild),a.hasAristotle(e.hasAristotle===!0))},a.scienceExplanation=ko.computed(function(){var e=f(a.tablet()),t=f(a.gear()),n=f(a.compass()),o=f(a.wild()),r=a.setMultiplier(),i=sciencesolver.assignWildcards(e,t,n,o,r),c=i.tablet-e,l=i.gear-t,u=i.compass-n,s="";o>0&&(s+="Wilds: "+c+" tablets, "+l+" gears, "+u+" compasses.<br /><br />"),a.isAristotleActive()&&a.hasAristotle()&&(s+="Aristotle leader: set bonus increased to 10<br /><br />");var m=function(e,t,n){var a="",o=t-n;return a+="("+o+" "+e,1!==o&&("s"===e[e.length-1]&&(a+="e"),a+="s"),n>0&&(a+=" + "+n+" wild",1!==n&&(a+="s")),a+=")&#178;"};i.tablet&&(s+=m("tablet",i.tablet,c)),i.gear&&(i.tablet&&(s+=" + "),s+=m("gear",i.gear,l)),i.compass&&((i.tablet||i.gear)&&(s+=" + "),s+=m("compass",i.compass,u));var d=Math.min(i.tablet,Math.min(i.gear,i.compass));return d&&((i.tablet||i.gear||i.compass)&&(s+=" + "),s+=i.setMultiplier+" * ",s+="("+d+" complete set",1!==d&&(s+="s"),s+=")"),s+=" = "+i.score()}),a},h=function(t){var n={babelTileCountEditable:ko.observable(null)};return n.babelTileCount=ko.computed(function(){var e=n.babelTileCountEditable();return b(e,{min:t.min,max:t.max})}).extend({throttle:400}),n.score=ko.computed(function(){var e=f(n.babelTileCount());return isNaN(e)?null:0>=e?0:Math.pow(e,2)+1}),n.swapWith=function(t){e(n.babelTileCountEditable,t.babelTileCountEditable)},n.clear=function(){n.babelTileCountEditable(null)},n.toJS=function(){var e={};return e.babelTileCount=n.babelTileCount(),e},n.fromJS=function(e){e&&n.babelTileCountEditable(e.babelTileCount)},n},k=function(e,t,n){n=n||{};var a=ko.isComputed(n.min)?n.min:f(n.min),o=ko.isComputed(n.max)?n.max:p(n.max,999),r={id:e,name:t,inputType:n.inputType||"number",min:a,max:o,categoryValueTemplate:n.categoryValueTemplate||"categoryDefaultTemplate",playerValueTemplate:n.playerValueTemplate||"playerDefaultTemplate"};return n.requiredExpansion?(r.active=ko.computed(function(){return n.requiredExpansion.active()}),r.conditional=!0):(r.active=ko.computed(function(){return!0}),r.conditional=!1),r.createScoreModel=n.createScoreModel||v,r},y=k("science","Science",{max:99,categoryValueTemplate:"categoryScienceTemplate",playerValueTemplate:"playerScienceTemplate",createScoreModel:g}),E=k("leaders","Leaders",{requiredExpansion:n}),S=k("cities","Cities",{requiredExpansion:a}),x=k("towerOfBabel","Tower of Babel",{requiredExpansion:o,categoryValueTemplate:"categoryTowerOfBabelTemplate",playerValueTemplate:"playerTowerOfBabelTemplate",createScoreModel:h,max:3}),w=k("greatProjects","Great Projects",{requiredExpansion:r,min:-99}),T=[k("military","Military",{min:-999,max:999}),k("treasury","Money",{min:-999}),k("wonder","Wonders",{max:99}),k("civilian","Civilian"),k("commercial","Commercial"),k("guilds","Guilds"),y,E,S,x,w],A=ko.computed(function(){var e=[];return $.each(T,function(t,n){n.active()===!0&&e.push(n)}),e}),J=ko.computed(function(){return A()[0]});$.each(T,function(e,t){if(t==y||t.conditional===!0)t.next=ko.computed(function(){var e,n=A(),a=$.inArray(t,n);return a<n.length-1&&(e=n[a+1]),e}),t.hasNext=ko.computed(function(){return"object"==typeof t.next()});else{var n=T[e+1];t.next=ko.computed(function(){return n}),t.hasNext=ko.computed(function(){return!0})}});var C=function(){var e={};return $.each(T,function(t,n){e[n.id]=n.createScoreModel(n)}),e.total=ko.computed(function(){var t,n=0;for(i in T){var t=T[i];n+=f(e[t.id].score())}return n}),e.swapWith=function(t){$.each(T,function(n,a){e[a.id].swapWith(t[a.id])})},e.clear=function(){$.each(T,function(t,n){e[n.id].clear()})},e.toJS=function(){var t={};return $.each(T,function(n,a){t[a.id]=e[a.id].toJS()}),t},e.fromJS=function(t){t&&$.each(T,function(n,a){e[a.id].fromJS(t[a.id])})},e},M=function(e){return null==e?!0:e.replace(/\s/g,"").length<1},B=3,N=ko.observable(B),W=ko.computed(function(){return a.active()?8:7}),P=function(t){var n={id:"player"+t,label:"Player "+t,number:t,nameEditable:ko.observable(""),score:C()};return n.name=ko.computed(n.nameEditable).extend({throttle:400}),3>=t?(n.nameOrDefault=ko.computed(function(){var e=n.name();return e&&e.length>30&&(e=e.substring(0,30)),M(e)?"Player "+t:e}),n.active=ko.computed(function(){return!0})):(n.nameOrDefault=ko.computed(function(){return n.name()}),n.active=ko.computed(function(){return n.number>W()?!1:!M(n.name())})),n.hasScienceScoreExplanation=ko.computed(function(){var e=n.score[y.id];return e.score()>0}),n.scienceScoreExplanation=ko.computed(function(){var e=n.score[y.id];return e.scienceExplanation()}),n.swapWith=function(t){e(n.nameEditable,t.nameEditable),n.score.swapWith(t.score)},n.clear=function(){n.nameEditable(""),n.score.clear()},n.clearScores=function(){n.score.clear()},n.toJS=function(){var e={};return e.name=n.name(),e.score=n.score.toJS(),e},n.fromJS=function(e){n.nameEditable(e.name),n.score.fromJS(e.score)},n},O=8,V=function(){var e,t=[];for(e=1;O>=e;e++)t.push(P(e));return t},j=V(),L=ko.computed(function(){return $.grep(j,function(e){return e.active()})}),q=ko.computed(function(){return L()[0]});$.each(j,function(e,t){t.next=ko.computed(function(){var e,n=L(),a=$.inArray(t,n);return a<n.length-1&&(e=n[a+1]),e}),t.hasNext=ko.computed(function(){return"object"==typeof t.next()});var n=e+1;if(t.playerNumber=n,2>=n)t.isEditable=ko.computed(function(){return!0});else{var a=j[e-1],o=j[e-2],r=j.slice(e);t.isEditable=ko.computed(function(){return n>W()?!1:n<=N()?!0:t.active()||!M(a.name())||!M(o.name())||$.grep(r,function(e){return e.active()}).length>0})}});var D=ko.computed(function(){return $.grep(j,function(e){return e.isEditable()})}),G=ko.computed(function(){var e=D().length,t=W();return t>e}),I=function(){var e=D().length,t=W();t>e&&N(e+1)},F=function(e){e.clear();var t=e.playerNumber-1,n=j.slice(t),a=e;$.each(n,function(e,t){t.swapWith(a),t.clear(),a=t});var o=N()-1;o=Math.max(B,o),N(o)},z=ko.computed(function(){var e=j.slice(0);return e.sort(function(e,t){return t.score.total()-e.score.total()}),e}),H=function(e){var t={id:"team"+e,label:"Team "+e,name:"Team "+e,number:e},n=2*(e-1),a=ko.computed(function(){return u.active()?t:{}}),o=j[n];o.team=a,o.isTeamStart=ko.computed(function(){return u.active()?!0:!1});var r=j[n+1];return r.team=a,r.isTeamStart=ko.computed(function(){return!1}),t.players=[o,r],t.totalScore=ko.computed(function(){return o.score.total()+r.score.total()}),t.active=ko.computed(function(){return o.active()}),t},K=O/2,Q=function(){var e,t=[];for(e=1;K>=e;e++)t.push(H(e));return t},R=Q(),U=ko.computed(function(){var e=R.slice(0);return e.sort(function(e,t){return t.totalScore()-e.totalScore()}),e}),X={players:j,playersByScore:z,isTeams:ko.computed(function(){return u.active()}),teams:R,teamsByScore:U,categories:T,scienceCategory:y,expansions:c,options:s,isAvailableOption:d,activePlayers:L,firstActivePlayer:q,isAddPlayerActionAvailable:G,addPlayer:I,removePlayer:F,activeCategories:A,firstActiveCategory:J};return X.clear=function(){$.each(X.players,function(e,t){t.clear()}),N(B)},X.clearScores=function(){$.each(X.players,function(e,t){t.clearScores()})},X.toJS=function(){var e={};return e.players=[],$.each(X.players,function(t,n){n.active()===!0&&e.players.push(n.toJS())}),e.expansions={},$.each(X.expansions,function(t,n){e.expansions[n.id]=n.active()}),e.options={},$.each(X.options,function(t,n){e.options[n.id]=n.active()}),e},X.toJSON=function(){var e=X.toJS();return JSON.stringify(e)},X.fromJS=function(e){if(e.players){var t;for(t=0;t<X.players.length;t++)if(t<e.players.length){var n=e.players[t];X.players[t].fromJS(n)}else X.players[t].clear()}e.expansions&&$.each(X.expansions,function(t,n){n.active(e.expansions[n.id]!==!1)}),e.options&&$.each(X.options,function(t,n){n.active(e.options[n.id]!==!1)})},X.saveToLocalStorage=function(){if(window.localStorage){var e=X.toJS(),t=JSON.stringify(e);window.localStorage.setItem("sevenwonders.currentGame",t)}},X.loadFromLocalStorage=function(){if(window.localStorage)try{var e=window.localStorage.getItem("sevenwonders.currentGame"),t=JSON.parse(e);"object"==typeof t&&null!==t&&X.fromJS(t)}catch(n){window.console&&console.log(n)}},X},n=function(e){e.loadFromLocalStorage(),$(document).on("pagebeforehide",'[data-role="page"]',function(){e.saveToLocalStorage()}),$(window).unload(function(){e.saveToLocalStorage()})};$(document).on("mobileinit",function(){$.mobile.page.prototype.options.addBackBtn=!0,$(function(){var e=t();n(e),ko.applyBindings(e),$.mobile.initializePage()})})}();